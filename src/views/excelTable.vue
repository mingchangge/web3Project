<template>
  <div>
    <el-tabs v-model="activeName" type="border-card" stretch :lazy="true" @tab-click="handleClick">
      <el-tab-pane v-for="item in sheets" :key="item.tid" :label="item.label" :name="item.tid">
        <h2 class="title">{{ item.label }}</h2>
        <!-- <el-table :data="tableData" style="width: 100%">
          <el-table-column label="a1" />
          <el-table-column label="a2" />
          <el-table-column label="a3" />
        </el-table> -->
      </el-tab-pane>
    </el-tabs>
  </div>
</template>
<script>
import * as XLSX from 'xlsx'
import axios from 'axios'

export default {
  name: 'ExcelTable',
  data() {
    return {
      url: '/balance_2024.xlsx',
      contentArray: [],
      data: undefined,
      sheets: [],
      mergeArray: [],
      activeName: 0
    }
  },
  created() {
    axios
      .get(this.url, { responseType: 'arraybuffer' })
      .then((res) => {
        let data = new Uint8Array(res.data)
        let wb = XLSX.read(data, { type: 'array' })
        let sheets = wb.Sheets
        let count = 0
        for (let key in sheets) {
          //生成tabs
          this.sheets.push({ tid: (count++).toString(), label: key })
          //生成表格合并数据
          this.mergeArray = sheets[key]['!merges']
          //生成表格数据
          this.contentArray.push(sheets[key])
        }
        this.activeName = this.sheets[0].tid
        this.transformSheet(this.contentArray[this.activeName])
      })
      .catch((err) => {
        console.log(err)
      })
  },
  methods: {
    handleClick(tab) {
      let index = this.sheets.findIndex((item) => item.label === tab.props.label)
      this.formateExcel(index)
    },
    //转换表格数据
    transformSheet(sheet) {
      console.log(sheet, 'sheet')
      for (let key in sheet) {
        if (key == '!ref' || key == '!margins' || key == '!merges') continue
      }
    }
  }
}
////////////////////////////////////////////////
// let arr = [
//   [
//     null,
//     '总供给',
//     null,
//     null,
//     null,
//     '总需求',
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     null,
//     '供需差额'
//   ],
//   [
//     '时间',
//     '生产量（+）',
//     '进口量（+）',
//     '出口量（-）',
//     '合计',
//     '电力行业',
//     '电力耗煤占比',
//     '冶金行业',
//     '冶金耗煤占比',
//     '化工行业',
//     '化工耗煤占比',
//     '建材行业',
//     '建材耗煤占比',
//     '供热行业',
//     '供热耗煤占比',
//     '其他行业',
//     '其他耗煤占比',
//     '合计',
//     '供需差额'
//   ],
//   [
//     null,
//     '（万吨）',
//     '（万吨）',
//     '（万吨）',
//     '（万吨）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（%）',
//     '（万吨）',
//     '（万吨）'
//   ],
//   [
//     '2023年',
//     467821.09,
//     35365.98,
//     162.59,
//     503024.48,
//     260581.1,
//     57.66057488443593,
//     44110.79,
//     9.760698339237296,
//     32553.6,
//     7.203359301798839,
//     41257.2,
//     9.129264824356602,
//     31736.53,
//     7.022560594905569,
//     41683.26,
//     9.223542055265762,
//     451922.48,
//     51102
//   ],
//   [
//     '2022年',
//     448625,
//     21839.25,
//     164.44,
//     470299.81,
//     244377.66,
//     57.14621714517046,
//     43538.51,
//     10.181213563617785,
//     31347.67,
//     7.330460389935584,
//     42635.75,
//     9.970108673792856,
//     28552.37,
//     6.6767966271108845,
//     37183.8,
//     8.69520360037243,
//     427635.76,
//     42664.04999999999
//   ],
//   [
//     '2021年',
//     402615.6,
//     25984.14,
//     101.18,
//     428498.56,
//     241528.53,
//     56.46914409973811,
//     43252.49,
//     10.112391651961289,
//     30424.88,
//     7.113308448228622,
//     47255.86,
//     11.048375808427478,
//     30232.34,
//     7.068292776560503,
//     35023.61,
//     8.188487215083985,
//     427717.71,
//     780.8499999999767
//   ],
//   [
//     '2020年',
//     381214,
//     22371.12,
//     99.96,
//     403485.16,
//     219782.2,
//     54.21513790988749,
//     44483.46,
//     10.97303111266046,
//     27803.03,
//     6.858358437410941,
//     47445.37,
//     11.703665163674032,
//     26199.8,
//     6.462879023922184,
//     39675.13,
//     9.786928352444894,
//     405388.99,
//     -1903.8300000000163
//   ],
//   [
//     '2019年',
//     370511.3,
//     21813.88,
//     260.81,
//     392064.37,
//     215578.6,
//     55.25810931092885,
//     40891.85,
//     10.481589161568476,
//     25690.95,
//     6.585223781032104,
//     46446.33,
//     11.905339306552106,
//     26198.4,
//     6.715295724953398,
//     35324.11,
//     9.05444015171856,
//     390130.25,
//     1934.1199999999953
//   ],
//   [
//     '2018年',
//     351985.5,
//     20697.96,
//     210.43,
//     372473.03,
//     207312.57,
//     54.6272049752485,
//     38654.63,
//     10.185558918363656,
//     24513.98,
//     6.45947426255505,
//     44334.27,
//     11.682153449344678,
//     27318.38,
//     7.198438299480485,
//     37370.41,
//     9.847164824974561,
//     379504.26,
//     -7031.229999999981
//   ],
//   [
//     '2017年',
//     348886.3,
//     18837.57,
//     358.1,
//     367365.77,
//     194086.88,
//     53.49476154138612,
//     36157.16,
//     9.965736232215924,
//     21047.66,
//     5.80121414030753,
//     47781.58,
//     13.169690955775392,
//     23899.48,
//     6.587240639671917,
//     39841.97,
//     10.981353734415531,
//     362814.74,
//     4551.030000000028
//   ],
//   [
//     '2016年',
//     334248.18,
//     16999.15,
//     388.54,
//     350858.79000000004,
//     184575.4,
//     54.274487017891346,
//     35133.59,
//     10.33104939416042,
//     21982.02,
//     6.463823776716876,
//     46052.25,
//     13.541686729486631,
//     21597.87,
//     6.35086428055475,
//     30736.51,
//     9.038085860685051,
//     340077.65,
//     10781.140000000014
//   ],
//   [
//     '2015年',
//     365144.6,
//     13179.49,
//     133.13,
//     378190.95999999996,
//     176104.25,
//     52.99751336010692,
//     35037.74,
//     10.544396820394466,
//     21838.07,
//     6.572035635618959,
//     46886.08,
//     14.110083380742042,
//     19985.83,
//     6.014615163676207,
//     32435.79,
//     9.76135563946141,
//     332287.76,
//     45903.19999999995
//   ],
//   [
//     '2014年',
//     361600,
//     19881.78,
//     260.36,
//     381221.42000000004,
//     176783.68,
//     53.23208026356166,
//     35682.09,
//     10.744384769293358,
//     18404.91,
//     5.541980155428536,
//     49310.47,
//     14.848083809964526,
//     19529.83,
//     5.880709566028462,
//     32388.9,
//     9.75275842458123,
//     332099.89,
//     49121.53000000003
//   ],
//   [
//     '2013年',
//     358532,
//     21216,
//     378.62,
//     379369.38,
//     176222.93,
//     53.52379635648782,
//     35523.45,
//     10.789458010259375,
//     19573.97,
//     5.945158125381312,
//     48083.16,
//     14.604190635216549,
//     17850.48,
//     5.421686362754034,
//     31988.2,
//     9.715704435345637,
//     329242.21,
//     50127.169999999984
//   ],
//   [
//     '2012年',
//     359347,
//     20076.87,
//     475.35,
//     378948.52,
//     161350.78,
//     53.11423709461952,
//     33066.1,
//     10.884860148766547,
//     18796.76,
//     6.187609178280145,
//     43867.37,
//     14.440474913709123,
//     17233.61,
//     5.673043833666041,
//     29466.04,
//     9.699774830958628,
//     303780.66,
//     75167.86000000004
//   ],
//   [
//     '2011年',
//     350402.03,
//     14158.08,
//     686.34,
//     363873.77,
//     159468.08,
//     54.29293335956712,
//     31730.41,
//     10.803021116211735,
//     16165.76,
//     5.503838325430116,
//     41163.57,
//     14.014660255844783,
//     16679.79,
//     5.678846368010288,
//     28510.33,
//     9.706703979562977,
//     293717.93,
//     70155.84000000003
//   ]
// ]

////////////////////////////////////////////////
</script>
